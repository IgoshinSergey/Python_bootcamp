import sys

from bs4 import BeautifulSoup


def read_file(filepath: str) -> str:
    with open(filepath, 'r') as file:
        return file.read()


def write_file(filepath: str, text: str):
    with open(filepath, 'w') as file:
        file.write(text)


def set_title_text(soup: BeautifulSoup) -> None:
    title_text = "Evil Corp - Stealing your money every day"
    soup.title.string = title_text


def add_h1_tag(soup: BeautifulSoup) -> None:
    pronoun_and_name = soup.find("span", class_="name")
    pronoun, name = pronoun_and_name.text.split()
    new_h1 = soup.new_tag("h1")
    new_h1.string = f"{pronoun} {name}, you are hacked!"
    soup.body.insert(0, new_h1)


def add_script_tag(soup: BeautifulSoup) -> None:
    new_script = soup.new_tag("script")
    new_script.string = """
    hacked = function() {
        alert('hacked');
    }
    window.addEventListener('load', 
      function() { 
        var f = document.querySelector("form");
        f.setAttribute("onsubmit", "hacked()");
      },
      false
    );"""
    soup.body.insert(0, new_script)


def set_link_in_button(soup: BeautifulSoup) -> None:
    soup.a["href"] = "https://mrrobot.fandom.com/wiki/Fsociety"


def main():
    filename_read = "evilcorp.html"
    filename_write = "evilcorp_hacked.html"
    directory = "../materials/"
    
    html_text: str = read_file(f"{directory}{filename_read}")
    bs: BeautifulSoup = BeautifulSoup(html_text, "html.parser")

    set_title_text(bs)
    add_h1_tag(bs)
    add_script_tag(bs)
    set_link_in_button(bs)

    save_text = bs.prettify()
    write_file(f"{directory}{filename_write}", save_text)


if __name__ == "__main__":
    main()
